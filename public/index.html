<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eleutherios - Governance through Love in Action</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Main Navigation */
        .main-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: #4c51bf;
            text-decoration: none;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #4c51bf, #667eea);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-link {
            color: #6b7280;
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-link:hover,
        .nav-link.active {
            background: #4c51bf;
            color: white;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .cart-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(76, 81, 191, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4c51bf;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cart-icon:hover {
            background: #4c51bf;
            color: white;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4c51bf, #667eea);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        /* Page Container */
        .page-container {
            max-width: 1200px;
            margin: 0 auto;
            min-height: calc(100vh - 80px);
        }

        .page-content {
            padding: 2rem;
        }

        /* Page sections */
        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        /* Section headers and create buttons */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem 2rem;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .section-header h2 {
            color: #4c51bf;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
        }

        .filter-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .create-btn {
            padding: 10px 20px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
            white-space: nowrap;
        }

        .create-btn:hover {
            background: #059669;
        }

        /* Item grids and cards for services, forums, policies */
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .item-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .item-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .item-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .item-card h3 {
            color: #1f2937;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .item-card p {
            color: #6b7280;
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 1rem;
        }

        .item-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #4c51bf;
            font-weight: 500;
        }

        /* Home Page */
        .placeholder-page {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 3rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .placeholder-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #4c51bf, #667eea);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            margin: 0 auto 2rem;
        }

        .filters {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .search-container {
            position: relative;
            margin-bottom: 1rem;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #4c51bf;
        }

        .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }

        .filter-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: #4c51bf;
            color: white;
            border-color: #4c51bf;
        }

        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .user-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .user-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .card-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4c51bf, #667eea);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .cert-score {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4c51bf, #667eea);
            color: white;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 1rem;
        }

        .user-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .user-bio {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .user-meta {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-size: 12px;
        }

        .meta-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 8px;
            background: #f3f4f6;
            border-radius: 6px;
        }

        .meta-label {
            font-weight: 500;
            color: #374151;
        }

        .meta-value {
            font-weight: 600;
            color: #4c51bf;
        }

        .user-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            font-size: 12px;
            color: #6b7280;
        }

        .follow-btn {
            width: 100%;
            padding: 10px;
            background: #4c51bf;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .follow-btn:hover {
            background: #3730a3;
        }

        .follow-btn.following {
            background: #10b981;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            font-size: 18px;
            color: #6b7280;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .nav-container {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .nav-links {
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
            }

            .page-content {
                padding: 1rem;
            }

            .users-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Main Navigation -->
    <nav class="main-nav">
        <div class="nav-container">
            <a href="#" class="logo" onclick="app.showSection('home')">
                <div class="logo-icon">
                    <svg width="24" height="24" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="16" cy="11.5" r="4" fill="white"/>
                        <circle cx="11" cy="20.5" r="4" fill="white"/>
                        <circle cx="21" cy="20.5" r="4" fill="white"/>
                    </svg>
                </div>
                <span>Eleutherios</span>
            </a>
            
            <ul class="nav-links">
                <li><a href="#" class="nav-link" data-section="home" onclick="app.showSection('home')" title="Home">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                </a></li>
                <li><a href="#" class="nav-link" data-section="activities" onclick="app.showSection('activities')" title="Activities">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <line x1="3" y1="9" x2="21" y2="9"/>
                        <line x1="9" y1="21" x2="9" y2="9"/>
                    </svg>
                </a></li>
                <li><a href="#" class="nav-link" data-section="forums" onclick="app.showSection('forums')" title="Forums">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                </a></li>
                <li><a href="#" class="nav-link" data-section="services" onclick="app.showSection('services')" title="Services">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                </a></li>
                <li><a href="#" class="nav-link" data-section="policies" onclick="app.showSection('policies')" title="Policies">
                    <span class="material-icons" style="font-size: 20px;">account_balance</span>
                </a></li>
                <li><a href="#" class="nav-link" data-section="users" onclick="app.showSection('users')" title="Users">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                </a></li>
                <li><a href="#" class="nav-link" data-section="data" onclick="app.showSection('data')" title="Data">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <polyline points="10,9 9,9 8,9"/>
                    </svg>
                </a></li>
            </ul>
            
            <div class="user-menu">
                <div class="cart-icon" onclick="app.showSection('shopping')" title="Shopping Cart">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"/>
                        <circle cx="20" cy="21" r="1"/>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                    </svg>
                </div>
                <div class="user-avatar">U</div>
            </div>
        </div>
    </nav>

    <!-- Page Container -->
    <div class="page-container">
        <div class="page-content">
            
            <!-- Home Section -->
            <section id="home" class="page-section">
                <div class="placeholder-page">
                    <div class="placeholder-icon">üè†</div>
                    <h2>Welcome to Eleutherios</h2>
                    <p>A shared operating system for humankind ‚Äî enabling policies to be instantiated into live forums, connected with services, and grounded in data.</p>
                </div>
            </section>

            <!-- Activities Section -->
            <section id="activities" class="page-section">
                <div class="section-header">
                    <h2>Track user activities across forums, policies, and services</h2>
                    <button class="create-btn" onclick="app.createActivity()">Create Activity</button>
                </div>
                <div class="placeholder-page">
                    <div class="placeholder-icon">üìã</div>
                    <p>Monitor and manage user activities across all forums and policies they participate in.</p>
                </div>
            </section>

            <!-- Forums Section -->
            <section id="forums" class="page-section">
                <div class="section-header">
                    <h2>Spaces for dialogue, collaboration, and coordination</h2>
                    <button class="create-btn" onclick="app.createForum()">Create Forum</button>
                </div>
                <div class="placeholder-page">
                    <div class="placeholder-icon">üí¨</div>
                    <p>Instantiated expressions of policy rules for community discussion and collaborative decision-making.</p>
                </div>
            </section>

            <!-- Services Section -->
            <section id="services" class="page-section">
                <div class="section-header">
                    <h2>Analogue and digital agents that perform actions and consume policies</h2>
                    <button class="create-btn" onclick="app.createService()">Create Service</button>
                </div>
                <div class="placeholder-page">
                    <div class="placeholder-icon">‚öôÔ∏è</div>
                    <p>Browse and manage services that implement policy rules and provide functionality to the community.</p>
                </div>
            </section>

            <!-- Policies Section -->
            <section id="policies" class="page-section">
                <div class="section-header">
                    <h2>Root governance objects containing rules that define system behavior</h2>
                    <button class="create-btn" onclick="app.createPolicy()">Create Policy</button>
                </div>
                <div class="placeholder-page">
                    <div class="placeholder-icon">üìã</div>
                    <p>Create, manage, and explore governance policies. Policies contain rules that instantiate into forums, services, or other policies.</p>
                </div>
            </section>

            <!-- Users Section -->
            <section id="users" class="page-section active">
                <div class="filters">
                    <div class="search-container">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="M21 21l-4.35-4.35"></path>
                        </svg>
                        <input type="text" class="search-input" placeholder="Search users by name or expertise..." id="searchInput">
                    </div>
                    <div class="filter-row">
                        <div class="filter-buttons">
                            <button class="filter-btn active" data-filter="all">All Users</button>
                            <button class="filter-btn" data-filter="high-cert">High CERT Score</button>
                            <button class="filter-btn" data-filter="active">Recently Active</button>
                            <button class="filter-btn" data-filter="service-providers">Service Providers</button>
                            <button class="filter-btn" data-filter="highly-followed">Highly Followed</button>
                        </div>
                        <button class="create-btn" onclick="app.createUser()">Create Profile</button>
                    </div>
                </div>

                <div id="usersContainer">
                    <div class="loading">Loading users...</div>
                </div>
            </section>

            <!-- Shopping Section -->
            <section id="shopping" class="page-section">
                <div class="section-header">
                    <h2>Browse and purchase services and policy implementations</h2>
                </div>
                <div class="placeholder-page">
                    <div class="placeholder-icon">üõí</div>
                    <p>Discover and purchase services that implement governance policies and community solutions.</p>
                </div>
            </section>

            <!-- Data Section -->
            <section id="data" class="page-section">
                <div class="section-header">
                    <h2>Analytics, logs, and state management for governance insights</h2>
                </div>
                <div class="placeholder-page">
                    <div class="placeholder-icon">üìä</div>
                    <p>Raw records and analytics from services, forums, and policies for governance transparency and insights.</p>
                </div>
            </section>

        </div>
    </div>

    <script>
        class UsersManager {
            constructor() {
                this.users = [];
                this.filteredUsers = [];
                this.currentFilter = 'all';
                this.searchTerm = '';
                this.loaded = false;
                this.setupEventListeners();
            }

            async loadIfNeeded() {
                console.log('loadIfNeeded called, loaded:', this.loaded);
                if (!this.loaded) {
                    await this.loadUsers();
                    this.renderUsers();
                    this.loaded = true;
                } else {
                    this.renderUsers();
                }
            }

            async loadUsers() {
                try {
                    const response = await fetch('/api/users/public');
                    if (response.ok) {
                        const data = await response.json();
                        this.users = data.users || data;
                    } else {
                        this.users = this.generateMockUsers();
                    }
                } catch (error) {
                    console.log('API not available, using mock data');
                    this.users = this.generateMockUsers();
                }
                this.filteredUsers = [...this.users];
            }

            generateMockUsers() {
                const names = [
                    'Alice Johnson', 'Bob Smith', 'Carol Davis', 'David Wilson',
                    'Eva Brown', 'Frank Miller', 'Grace Lee', 'Henry Taylor',
                    'Iris Chen', 'Jack Anderson', 'Kate Rodriguez', 'Leo Thompson'
                ];

                const bios = [
                    'Policy researcher focused on sustainable governance models',
                    'Community organizer with expertise in participatory democracy',
                    'Tech entrepreneur building governance solutions',
                    'Social scientist studying collective decision-making',
                    'Legal expert in constitutional frameworks',
                    'Data analyst for policy impact measurement',
                    'Forum moderator and conflict resolution specialist',
                    'Service provider for digital identity verification',
                    'Governance consultant for DAOs and cooperatives',
                    'Academic researcher in political science',
                    'Community builder and stakeholder engagement expert',
                    'Software developer contributing to open governance'
                ];

                return names.map((name, index) => ({
                    id: 'user-' + (index + 1),
                    name: name,
                    email: name.toLowerCase().replace(' ', '.') + '@eleutherios.org',
                    bio: bios[index],
                    avatar: name.split(' ').map(n => n[0]).join(''),
                    certScore: Math.floor(Math.random() * 100),
                    stats: {
                        followers: Math.floor(Math.random() * 100),
                        following: Math.floor(Math.random() * 80),
                        services: Math.floor(Math.random() * 10),
                        activities: Math.floor(Math.random() * 20),
                        favourites: Math.floor(Math.random() * 15)
                    },
                    lastActive: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString(),
                    isFollowing: false,
                    location: ['Christchurch, NZ', 'Auckland, NZ', 'Wellington, NZ'][Math.floor(Math.random() * 3)]
                }));
            }

            setupEventListeners() {
                document.addEventListener('input', (e) => {
                    if (e.target.id === 'searchInput') {
                        this.searchTerm = e.target.value.toLowerCase();
                        this.applyFilters();
                    }
                });

                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('filter-btn')) {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentFilter = e.target.dataset.filter;
                        this.applyFilters();
                    }
                });
            }

            applyFilters() {
                if (!this.loaded) return;

                let filtered = [...this.users];

                if (this.searchTerm) {
                    filtered = filtered.filter(user => 
                        user.name.toLowerCase().includes(this.searchTerm) ||
                        user.bio.toLowerCase().includes(this.searchTerm) ||
                        user.email.toLowerCase().includes(this.searchTerm)
                    );
                }

                switch (this.currentFilter) {
                    case 'high-cert':
                        filtered = filtered.filter(user => user.certScore >= 70);
                        break;
                    case 'active':
                        filtered = filtered.filter(user => {
                            const daysSinceActive = (Date.now() - new Date(user.lastActive)) / (1000 * 60 * 60 * 24);
                            return daysSinceActive <= 7;
                        });
                        break;
                    case 'service-providers':
                        filtered = filtered.filter(user => user.stats.services >= 3);
                        break;
                    case 'highly-followed':
                        filtered = filtered.filter(user => user.stats.followers >= 30);
                        break;
                }

                this.filteredUsers = filtered;
                this.renderUsers();
            }

            renderUsers() {
                const container = document.getElementById('usersContainer');
                if (!container) return;
                
                if (this.filteredUsers.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No users found</h3>
                            <p>Try adjusting your search criteria or filters.</p>
                        </div>
                    `;
                    return;
                }

                const usersHTML = this.filteredUsers.map(user => `
                    <div class="user-card">
                        <div class="card-avatar">${user.avatar}</div>
                        <div class="cert-score">${user.certScore}</div>
                        <div class="user-name">${user.name}</div>
                        <div class="user-bio">${user.bio}</div>
                        
                        <div class="user-meta">
                            <div class="meta-item">
                                <span class="meta-label">Followers</span>
                                <span class="meta-value">${user.stats.followers}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Following</span>
                                <span class="meta-value">${user.stats.following}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Services</span>
                                <span class="meta-value">${user.stats.services}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Activities</span>
                                <span class="meta-value">${user.stats.activities}</span>
                            </div>
                        </div>

                        <div class="user-stats">
                            <span>${user.location || 'Location not set'}</span>
                            <span>CERT: ${user.certScore}</span>
                        </div>

                        <button class="follow-btn ${user.isFollowing ? 'following' : ''}" 
                                onclick="app.usersManager.toggleFollow('${user.id}')">
                            ${user.isFollowing ? 'Following' : 'Follow'}
                        </button>
                    </div>
                `).join('');

                container.innerHTML = `<div class="users-grid">${usersHTML}</div>`;
            }

            async toggleFollow(userId) {
                const user = this.users.find(u => u.id === userId);
                if (user) {
                    user.isFollowing = !user.isFollowing;
                    
                    try {
                        await fetch(`/api/users/${userId}/follow`, {
                            method: user.isFollowing ? 'POST' : 'DELETE',
                            headers: { 'Content-Type': 'application/json' }
                        });
                    } catch (error) {
                        console.log('Follow API not available');
                    }
                    
                    this.renderUsers();
                }
            }
        }

        class ServicesManager {
            constructor() {
                this.services = [];
                this.loaded = false;
            }

            async loadIfNeeded() {
                if (!this.loaded) {
                    await this.loadServices();
                    this.renderServices();
                    this.loaded = true;
                } else {
                    this.renderServices();
                }
            }

            async loadServices() {
                try {
                    const response = await fetch('/api/services/public');
                    if (response.ok) {
                        const data = await response.json();
                        this.services = data.services || data;
                    } else {
                        this.services = this.generateMockServices();
                    }
                } catch (error) {
                    console.log('Services API not available, using mock data');
                    this.services = this.generateMockServices();
                }
            }

            generateMockServices() {
                const serviceTypes = [
                    'Identity Verification', 'Payment Processing', 'Document Storage',
                    'Conflict Resolution', 'Community Moderation', 'Policy Template',
                    'Forum Management', 'Data Analytics', 'Voting System',
                    'Notification Service', 'File Sharing', 'Translation Service'
                ];

                return serviceTypes.map((type, index) => ({
                    id: 'service-' + (index + 1),
                    title: type + ' Service',
                    description: `Provides ${type.toLowerCase()} functionality for the community`,
                    ownerId: 'user-' + Math.floor(Math.random() * 12 + 1),
                    price: Math.random() > 0.5 ? Math.floor(Math.random() * 100) + 10 : 0,
                    currency: 'NZD',
                    status: 'Active',
                    createdAt: new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000).toISOString()
                }));
            }

            renderServices() {
                const container = document.querySelector('#services .placeholder-page');
                if (!container) return;

                const servicesHTML = this.services.map(service => `
                    <div class="item-card">
                        <div class="item-icon">‚öôÔ∏è</div>
                        <h3>${service.title}</h3>
                        <p>${service.description}</p>
                        <div class="item-meta">
                            <span>Price: ${service.price === 0 ? 'Free' : '$' + service.price + ' ' + service.currency}</span>
                            <span>Status: ${service.status}</span>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = `<div class="items-grid">${servicesHTML}</div>`;
            }
        }

        class ForumsManager {
            constructor() {
                this.forums = [];
                this.loaded = false;
            }

            async loadIfNeeded() {
                if (!this.loaded) {
                    await this.loadForums();
                    this.renderForums();
                    this.loaded = true;
                } else {
                    this.renderForums();
                }
            }

            async loadForums() {
                try {
                    const response = await fetch('/api/forums/public');
                    if (response.ok) {
                        const data = await response.json();
                        this.forums = data.forums || data;
                    } else {
                        this.forums = this.generateMockForums();
                    }
                } catch (error) {
                    console.log('Forums API not available, using mock data');
                    this.forums = this.generateMockForums();
                }
            }

            generateMockForums() {
                const forumTopics = [
                    'General Discussion', 'Policy Development', 'Technical Support',
                    'Community Guidelines', 'Feature Requests', 'Governance Proposals',
                    'Service Feedback', 'New Member Introductions', 'Project Collaboration',
                    'Resource Sharing', 'Event Planning', 'Local Chapters'
                ];

                return forumTopics.map((topic, index) => ({
                    id: 'forum-' + (index + 1),
                    title: topic,
                    description: `Forum for discussing ${topic.toLowerCase()}`,
                    stakeholders: Math.floor(Math.random() * 50) + 5,
                    messages: Math.floor(Math.random() * 200) + 10,
                    createdAt: new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000).toISOString()
                }));
            }

            renderForums() {
                const container = document.querySelector('#forums .placeholder-page');
                if (!container) return;

                const forumsHTML = this.forums.map(forum => `
                    <div class="item-card">
                        <div class="item-icon">üí¨</div>
                        <h3>${forum.title}</h3>
                        <p>${forum.description}</p>
                        <div class="item-meta">
                            <span>${forum.stakeholders} members</span>
                            <span>${forum.messages} messages</span>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = `<div class="items-grid">${forumsHTML}</div>`;
            }
        }

        class PoliciesManager {
            constructor() {
                this.policies = [];
                this.loaded = false;
            }

            async loadIfNeeded() {
                if (!this.loaded) {
                    await this.loadPolicies();
                    this.renderPolicies();
                    this.loaded = true;
                } else {
                    this.renderPolicies();
                }
            }

            async loadPolicies() {
                try {
                    const response = await fetch('/api/policies/public');
                    if (response.ok) {
                        const data = await response.json();
                        this.policies = data.policies || data;
                    } else {
                        this.policies = this.generateMockPolicies();
                    }
                } catch (error) {
                    console.log('Policies API not available, using mock data');
                    this.policies = this.generateMockPolicies();
                }
            }

            generateMockPolicies() {
                const policyTypes = [
                    'Community Guidelines', 'Data Privacy Policy', 'Service Terms',
                    'Governance Protocol', 'Conflict Resolution', 'Member Rights',
                    'Content Moderation', 'Financial Transparency', 'Open Source License',
                    'Accessibility Standards', 'Security Framework', 'Environmental Impact'
                ];

                return policyTypes.map((type, index) => ({
                    id: 'policy-' + (index + 1),
                    title: type,
                    description: `Defines rules and guidelines for ${type.toLowerCase()}`,
                    visibility: Math.random() > 0.3 ? 'public' : 'private',
                    rules: Math.floor(Math.random() * 10) + 1,
                    createdAt: new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000).toISOString()
                }));
            }

            renderPolicies() {
                const container = document.querySelector('#policies .placeholder-page');
                if (!container) return;

                const policiesHTML = this.policies.map(policy => `
                    <div class="item-card">
                        <div class="item-icon">üèõÔ∏è</div>
                        <h3>${policy.title}</h3>
                        <p>${policy.description}</p>
                        <div class="item-meta">
                            <span>${policy.rules} rules</span>
                            <span>${policy.visibility}</span>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = `<div class="items-grid">${policiesHTML}</div>`;
            }
        }

        class EleutherosApp {
            constructor() {
                this.currentSection = 'users';
                this.usersManager = new UsersManager();
                this.servicesManager = new ServicesManager();
                this.forumsManager = new ForumsManager();
                this.policiesManager = new PoliciesManager();
                this.init();
            }

            init() {
                this.showSection('users');
                this.usersManager.loadIfNeeded();
            }

            showSection(sectionId) {
                document.querySelectorAll('.page-section').forEach(section => {
                    section.classList.remove('active');
                });

                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.classList.add('active');
                    this.currentSection = sectionId;
                }

                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                
                const activeLink = document.querySelector(`[data-section="${sectionId}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }

                switch(sectionId) {
                    case 'users':
                        this.usersManager.loadIfNeeded();
                        break;
                    case 'services':
                        this.servicesManager.loadIfNeeded();
                        break;
                    case 'forums':
                        this.forumsManager.loadIfNeeded();
                        break;
                    case 'policies':
                        this.policiesManager.loadIfNeeded();
                        break;
                }
            }

            createUser() {
                alert('Create User Profile - This will open a form to create a new user profile');
            }

            createActivity() {
                alert('Create Activity - This will open a form to create a new activity');
            }

            createForum() {
                alert('Create Forum - This will open a form to create a new discussion forum');
            }

            createService() {
                alert('Create Service - This will open a form to create a new service');
            }

            createPolicy() {
                alert('Create Policy - This will open a form to create a new governance policy');
            }
        }

        const app = new EleutherosApp();
    </script>
</body>
</html>